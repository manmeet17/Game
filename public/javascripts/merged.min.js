var questions,playerId,socket,speed=100,speedFactor=.005,currentHealth=100,score=1,movingSpeed=1.5,level=0,i=0,correct=0,cycles=0,gamePaused=!1,playerScore=0,reducedHealthFlag1=!1,reducedHealthFlag2=!1,reducedHealthFlag3=!1,gameStart=!1,currentChannel={pogo:1,pogo2:0,potHole:1,chair:1},IMAGE_HOLDER=[{src:"../images/healthBar.png",id:"healthBar"},{src:"../images/trees.png",id:"trees"},{src:"../images/mainRoad.png",id:"mainRoad"},{src:"../images/sky.png",id:"sky"},{src:"../images/buildingsFront.png",id:"buildingsFront"},{src:"../images/buildingsBack.png",id:"buildingsBack"},{src:"../images/carsUpperLane.png",id:"carsUpperLane"},{src:"../images/carsLowerLane.png",id:"carsLowerLane"},{src:"../images/foothPath.png",id:"footPath"},{src:"../images/trees.png",id:"trees"},{src:"../images/pogoStick.png",id:"pogoStick"},{src:"../images/potHole.png",id:"potHole"},{src:"../images/scorebg.png",id:"scorebg"},{src:"../images/chair.png",id:"chair"},{src:"../images/guyWheelchair.png",id:"guyWheelchair"},{src:"../images/pogoStick2.png",id:"pogoStick2"},{src:"../images/thunder.png",id:"thunder"}];function initTweens(e){var t=500;createjs.Tween.get(footPath,{loop:!0}).to({x:-w/2},45*t),createjs.Tween.get(footPath2,{loop:!0}).to({x:-w/2},45*t),createjs.Tween.get(buildingsBack,{loop:!0}).to({x:-w},35e3),createjs.Tween.get(buildingsBack2,{loop:!0}).to({x:-w},35e3),createjs.Tween.get(buildingsFront,{loop:!0}).to({x:-w},3e4),createjs.Tween.get(buildingsFront2,{loop:!0}).to({x:-w},3e4),createjs.Tween.get(trees,{loop:!0}).to({x:-w},3e4),createjs.Tween.get(trees2,{loop:!0}).to({x:-w},3e4),createjs.Tween.get(mainRoad1,{loop:!0}).to({x:-w},3e4),createjs.Tween.get(mainRoad2,{loop:!0}).to({x:-w},3e4),createjs.Tween.get(carsLowerLane,{loop:!0}).to({x:-w},35*t),createjs.Tween.get(carsLowerLane2,{loop:!0}).to({x:-w},35*t),createjs.Tween.get(carsUpperLane,{loop:!0}).to({x:-w},2e4),createjs.Tween.get(carsUpperLane2,{loop:!0}).to({x:-w},2e4)}function tick(e){if(!gamePaused){var t=potHole.localToLocal(0,0,chair);chair.hitTest(t.x,t.y)?reducedHealthFlag1||currentChannel.chair==currentChannel.potHole&&(changeHealth(),thunder.gotoAndPlay("lightning1"),chair.gotoAndPlay("hit"),playSoundOnHit(),reducedHealthFlag1=!0,potHole.gotoAndPlay("moveLid")):t.x<=chair.x&&(reducedHealthFlag1=!1);var a=pogo.localToLocal(50,100,chair);chair.hitTest(a.x,a.y)?reducedHealthFlag2||currentChannel.chair==currentChannel.pogo&&(changeHealth(),playSoundOnHit(),thunder.gotoAndPlay("lightning1"),chair.gotoAndPlay("hit"),reducedHealthFlag2=!0):a.x<=50&&(reducedHealthFlag2=!1);var o=pogo2.localToLocal(50,100,chair);chair.hitTest(o.x,o.y)?reducedHealthFlag3||currentChannel.chair==currentChannel.pogo2&&(changeHealth(),playSoundOnHit(),thunder.gotoAndPlay("lightning1"),chair.gotoAndPlay("hit"),reducedHealthFlag3=!0):o.x<=50&&(reducedHealthFlag3=!1),0==currentChannel.chair&&0!=currentChannel.pogo||"1"==currentChannel.chair&&"2"==currentChannel.pogo?stage.setChildIndex(pogo,stage.getNumChildren()-1):0==currentChannel.chair&&0!=currentChannel.pogo2||"1"==currentChannel.chair&&"2"==currentChannel.pogo2?stage.setChildIndex(pogo2,stage.getNumChildren()-1):stage.setChildIndex(chair,stage.getNumChildren()-1),score+=1,$(window).width()<=1280||"Win32"==navigator.platform?movingSpeed<=8&&(movingSpeed+=.001):movingSpeed<=12&&(movingSpeed+=.05);var n=changeScore(score);text.text=n,chair.scaleX=.5,chair.scaleY=.5,potHole.scale=.5,pogo.scaleX=.5,pogo.scaleY=.5,pogo2.scale=.5,pogo.visible&&(pogo.x-=movingSpeed),pogo2.visible&&(pogo2.x-=movingSpeed),potHole.visible&&(potHole.x-=movingSpeed),potHole.x<0?(potHole.x=null,potHole.visible=!1,r(potHole)):potHole.x=potHole.x,pogo.x<0&&(pogo.x=null,pogo.visible=!1,pogo.gotoAndPlay("jumpUp"),r(pogo)),pogo2.x<0&&(pogo2.x=null,pogo2.visible=!1,pogo2.gotoAndPlay("jumpUp"),r(pogo2)),stage.update(e)}function r(e){var t=Math.floor(2*Math.random()+1),a=Math.floor(3*Math.random());setTimeout(function(){setChannel(e,a),0==a?e.name.startsWith("pogo")?e.y=h-180:e.y=h-120:2==a?e.name.startsWith("pogo")?e.y=h-100:e.y=h-60:(upperLaneOccupied=!0,e.name.startsWith("pogo")?e.y=h-130:e.y=h-85),e.x=w,e.visible=!0},1e3*t)}}function keyboardMove(e){38==e.keyCode&&-35<chair.y&&(chair.y-=35,-35==chair.y?setChannel(chair,0):0==chair.y&&setChannel(chair,1)),40==e.keyCode&&chair.y<35&&(chair.y+=35,35==chair.y?setChannel(chair,2):0==chair.y&&setChannel(chair,1)),32==e.keyCode&&console.log(currentChannel)}function setChannel(e,t){currentChannel[e.name]=t}function changeHealth(){var e=(currentHealth-=10).toString(),t=document.getElementById("scoreP"),a=document.getElementById("score");healthBarSprite.gotoAndStop(e),0===currentHealth&&setTimeout(function(){gamePaused=!0,t.classList.remove("hide"),a.innerHTML=score;for(var e=0;e<100;e++)createjs.Sound.volume-=.01;socket.emit("crash",score)},100)}function changeScore(e){var t=e.toString().length;return"000000000".slice(0,-t)+e}function handleJumpStart(){chair.gotoAndPlay("jump")}$(document).on("initialize-game",function(){stage=new createjs.Stage("game-holder"),createjs.Touch.enable(stage),w=stage.canvas.width,h=stage.canvas.height,loader=new createjs.LoadQueue(!1),loader.addEventListener("complete",function(e){loader.getResult("healthBar");skyImg=loader.getResult("sky"),buildingsBackImg=loader.getResult("buildingsBack"),buildingsFrontImg=loader.getResult("buildingsFront"),carsUpperLaneImg=loader.getResult("carsUpperLane"),carsLowerLaneImg=loader.getResult("carsLowerLane"),treesImg=loader.getResult("trees"),mainRoadImg=loader.getResult("mainRoad"),scorebgImg=loader.getResult("scorebg"),footPathImg=loader.getResult("footPath"),sky=new createjs.Shape,buildingsBack=new createjs.Shape,buildingsBack2=new createjs.Shape,buildingsFront=new createjs.Shape,buildingsFront2=new createjs.Shape,carsUpperLane=new createjs.Shape,carsLowerLane=new createjs.Shape,mainRoad1=new createjs.Shape,mainRoad2=new createjs.Shape,footPath=new createjs.Shape,footPath2=new createjs.Shape,healthBar=new createjs.Shape,trees=new createjs.Shape,trees2=new createjs.Shape,scorebg=new createjs.Shape,carsLowerLane=new createjs.Shape,carsLowerLane2=new createjs.Shape,carsUpperLane=new createjs.Shape,carsUpperLane2=new createjs.Shape,sky.graphics.bf(skyImg).dr(0,0,w,skyImg.height),scorebg.graphics.bf(scorebgImg).dr(0,0,w,scorebgImg.height),mainRoad1.graphics.bf(mainRoadImg).dr(0,0,w,mainRoadImg.height),mainRoad2.graphics.bf(mainRoadImg).dr(mainRoadImg.width-2,0,w,mainRoadImg.height),trees.graphics.bf(treesImg).dr(0,0,w,treesImg.height),trees2.graphics.bf(treesImg).dr(treesImg.width,0,w,treesImg.height),buildingsBack.graphics.bf(buildingsBackImg).dr(0,0,buildingsBackImg.width,buildingsBackImg.height),buildingsBack2.graphics.bf(buildingsBackImg).dr(buildingsBackImg.width,0,buildingsBackImg.width,2*buildingsBackImg.height),buildingsFront.graphics.bf(buildingsFrontImg).dr(0,0,w,buildingsFrontImg.height),buildingsFront2.graphics.bf(buildingsFrontImg).dr(buildingsFrontImg.width,0,w,buildingsFrontImg.height),carsUpperLane.graphics.bf(carsUpperLaneImg).dr(0,0,w,carsUpperLaneImg.height),carsUpperLane2.graphics.bf(carsUpperLaneImg).dr(carsUpperLaneImg.width,0,w,carsUpperLaneImg.height),carsLowerLane.graphics.bf(carsLowerLaneImg).dr(0,0,w,carsLowerLaneImg.height),carsLowerLane2.graphics.bf(carsLowerLaneImg).dr(carsLowerLaneImg.width,0,w,carsLowerLaneImg.height),footPath.graphics.bf(footPathImg).dr(0,0,footPathImg.width,footPathImg.height),footPath2.graphics.bf(footPathImg).dr(footPathImg.width-1,0,footPathImg.width,footPathImg.height),text=new createjs.Text(score,"11px Arial","#ffffff"),text.x=220,text.y=33,text.textBaseline="alphabetic";var t=new createjs.SpriteSheet({framerate:30,images:[loader.getResult("healthBar")],frames:{regX:-350,height:38,count:11,regY:-10,width:152},animations:{0:[0,1,"0"],10:[0,1,1,1.5],20:[0,2,2,1.5],30:[0,3,3,1.5],40:[0,4,4,1.5],50:[0,5,5,1.5],60:[0,6,6,1.5],70:[0,7,7,1.5],80:[0,8,8,1.5],90:[0,9,9,1.5],100:[0,10,"100"],s100:[10]}}),a=new createjs.SpriteSheet({framerate:30,images:[loader.getResult("thunder")],frames:{regX:0,width:684,regY:0,height:384,count:40},animations:{blueSky:[0,"blueSky"],lightning1:[1,28,"lightning2",.06*speed],lightning2:[1,28,"lightning3",.06*speed],lightning3:[1,28,"blueSky",.06*speed]}}),o=new createjs.SpriteSheet({framerate:30,images:[loader.getResult("guyWheelchair")],frames:{regX:0,width:205,regY:0,height:200,count:62},animations:{move:[0,61,"move",.02*speed]}}),n=new createjs.SpriteSheet({framerate:30,images:[loader.getResult("pogoStick")],frames:{regX:0,height:233,count:90,regY:0,width:82},animations:{stand:[0],jumpUp:[60,89,"jumpUp",.013*speed],"jump-combine":[0,59,"stand-back",.015*speed],"stand-back":[50]}}),r=new createjs.SpriteSheet({framerate:30,images:[loader.getResult("pogoStick2")],frames:{regX:0,height:233,count:90,regY:0,width:82},animations:{stand:[0],jumpUp:[60,89,"jumpUp",.013*speed],"jump-combine":[0,59,"stand-back",.015*speed],"stand-back":[50]}}),i=new createjs.SpriteSheet({framerate:30,images:[loader.getResult("chair")],frames:{regX:-340,height:264,count:224,regY:-450,width:203},animations:{stand:[0],shout:[1,37,"move"],move:[106,160,"move",.05*speed],jump:[38,105,"move",.025*speed],hit:[164,224,"move",.04*speed]}});thunder=new createjs.Sprite(a,"blueSky"),healthBarSprite=new createjs.Sprite(t,"s100"),pogo=new createjs.Sprite(n,"jumpUp"),pogo2=new createjs.Sprite(r,"jumpUp"),chair=new createjs.Sprite(i,"move"),guy=new createjs.Sprite(o,"move"),chair.name="chair",pogo.name="pogo",pogo2.name="pogo2",pogo.x=w,pogo.y=h-130,pogo2.x=w+50,pogo2.y=h-180,s=new createjs.SpriteSheet({framerate:30,images:[loader.getResult("potHole")],frames:{regX:0,height:105,count:13,regY:0,width:80},animations:{openLid:{frames:[0],next:"openLid"},closeLid:{frames:[10,11,12],next:"openLid",speed:.001*speed},moveLid:[0,9,"closeLid",.003*speed]}}),potHole=new createjs.Sprite(s,"openLid"),potHole.x=w-77,potHole.y=h-85,potHole.name="potHole",stage.addChild(thunder,scorebg,buildingsBack,buildingsBack2,buildingsFront,buildingsFront2,trees,trees2,footPath,footPath2,mainRoad1,mainRoad2,carsUpperLane,carsUpperLane2,carsLowerLane,carsLowerLane2,pogo,pogo2,healthBarSprite,potHole,chair,text),this.document.onkeydown=keyboardMove,createjs.Ticker.timingMode=createjs.Ticker.RAF,event.paused||initTweens();var s}),loader.loadManifest(IMAGE_HOLDER,!0,"../images/")}),$(document).on("initialize-socket",function(){(socket=io()).on("fetchedQuestions",function(e,t){$("#game").css("display","none"),$(".questions").css("display","block"),quiz.loadQuestions(e,t),quiz.showNextQuestion()}),socket.on("mismatch",function(){window.alert("There was a discrepancy"),location.href="/"}),socket.on("answer",function(e){quiz.checkedAnswer(e)}),socket.on("restart",function(e,t){$("#game").css("display","block"),$(".questions").css("display","none"),currentHealth=10*e,changeScore(t);var a=currentHealth.toString();healthBarSprite.gotoAndStop(a),createjs.Sound.volume=1,movingSpeed=$(window).width()<=1280||"Win32"==navigator.platform?4:8,gamePaused=!1,2==++cycles&&(gamePaused=!0,socket.emit("game-over",t,playerId))}),socket.on("show-score",function(e){location.href="/game-over/"+playerId})}),$(document).on("fire-game",function(e){createjs.Ticker.addEventListener("tick",tick),gamePaused=!0,loadSound(),"Win32"==navigator.platform&&console.log("Playing on Windows"),1280<=$(window).width()&&"Win32"!=navigator.platform&&(console.log("Playing on Mac"),movingSpeed=3),createjs.Sound.volume=0,$(".loader").css("visibility","visible"),setTimeout(function(){$(".loader").css("visibility","hidden"),gamePaused=!1,createjs.Sound.volume=1},3500)});var soundFiles=[{path:"../audio/thunder.mp3",key:"thunder",type:"mp3"},{path:"../audio/traffic.mp3",key:"traffic",type:"mp3",main:!0}];function loadSound(){soundFiles.forEach(function(e){createjs.Sound.alternateExtensions=e.type,e.main&&createjs.Sound.on("fileload",function(){sound=createjs.Sound.play(e.key,{interrupt:createjs.Sound.INTERRUPT_NONE,loop:-1,volume:.5})},this),createjs.Sound.registerSound(e.path,e.key)})}function playSoundOnHit(){createjs.Sound.play("thunder",{interrupt:createjs.Sound.INTERRUPT_NONE,volume:1})}var quiz={loadQuestions:function(e,t){questions=e,playerScore=t,playerId=$("#game-holder").data("id")},showNextQuestion:function(){questions.length>i?($("#a").css("display","none"),$("#b").css("display","none"),$("#c").css("display","none"),$("#d").css("display","none"),$(".qBody").text(questions[i].questionBody),0!=questions[i].option_a.length&&($("#a").css("display","inline-block"),$("label#fora").find("strong").text(questions[i].option_a)),0!=questions[i].option_b.length&&($("#b").css("display","inline-block"),$("label#forb").find("strong").text(questions[i].option_b)),0!=questions[i].option_c.length&&($("#c").css("display","inline-block"),$("label#forc").find("strong").text(questions[i].option_c)),0!=questions[i].option_d.length&&($("#d").css("display","inline-block"),$("label#ford").find("strong").text(questions[i].option_d)),$("label").click(function(e){e.preventDefault();var t=$(this).attr("id");$("input:radio[id="+t[t.length-1]+"]").prop("checked",!0)}),$(".hintBtn").click(function(e){e.preventDefault();var t=questions[i].hint;0!=t.length?$(".hint").text(t):$(".hint").text("Sorry No Hint Available")})):(socket.emit("quiz-done",correct,playerScore,playerId),correct=i=0,$(".questionCounter").attr("src","../images/assets/"+i+".png"))},checkAnswer:function(){var e=$("input[type='radio']:checked");e.length&&socket.emit("checkAnswer",{id:questions[i]._id,answer:e.val()})},checkedAnswer:function(e){i++;var t=e.correctOption,a=$("input[type='radio']:checked").val();e.answeredCorrect?correct++:$("#for"+a).find("strong").addClass("wrongAns"),$("#for"+t).find("strong").addClass("correctAns"),setTimeout(function(){$("#for"+a).find("strong").removeClass("wrongAns"),$("#for"+t).find("strong").removeClass("correctAns"),quiz.clearOption()},500)},clearOption:function(){10==i&&$(".questions").css("display","none"),$(".questionCounter").attr("src","../images/assets/"+i+".png"),$('input[type="radio"]:checked').prop("checked",!1),$(".qBody").text(""),$("label#fora").find("strong").text(""),$("label#forb").find("strong").text(""),$("label#forc").find("strong").text(""),$("label#ford").find("strong").text(""),$(".hint").text(""),this.showNextQuestion()}};